<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Space Grotesk', 'Segoe UI', '-apple-system', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        powerbi: {
                            primary: '#0078D4',
                            secondary: '#005A9E',
                            accent: '#FFB900',
                            background: '#FFFFFF',
                            card: '#F5F5F5'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Aplicar fonte Space Grotesk em todo o documento */
        body {
            font-family: 'Space Grotesk', 'Segoe UI', -apple-system, system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Ajustes de fonte para diferentes elementos */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', 'Segoe UI', -apple-system, system-ui, sans-serif;
            letter-spacing: -0.025em;
            font-weight: 600;
        }

        /* Melhorar a legibilidade do texto */
        p, span, a {
            font-family: 'Space Grotesk', 'Segoe UI', -apple-system, system-ui, sans-serif;
            letter-spacing: -0.0125em;
        }

        /* Ajuste fino para números */
        .font-numeric {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }
        .dashboard-card {
            backdrop-filter: blur(16px) saturate(180%);
            background-color: rgba(255, 255, 255, 0.75);
            border-radius: 12px;
            border: 1px solid rgba(209, 213, 219, 0.3);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
            width: 100%;
        }

        .gradient-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.9) 100%);
            pointer-events: none;
        }
    </style>
</head>
<body class="{{ theme.bg }} {{ theme.text }} min-h-screen transition-colors duration-300">
    <nav class="{{ theme.navbar }} transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="{{ theme.accent }} text-xl font-bold">Dashboard Generator</span>
                </div>
                <div class="flex items-center space-x-4">
                    {% if current_user.is_authenticated %}
                        <span class="{{ theme.accent }}">{{ current_user.nome }}</span>
                        <button onclick="logout()" class="{{ theme.btn }} px-4 py-2 rounded-lg text-white flex items-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9" />
                            </svg>
                            <span>Sair</span>
                        </button>
                    {% else %}
                        <button onclick="openModal('loginModal')" class="{{ theme.btn }} px-4 py-2 rounded-lg text-white">Login</button>
                        <button onclick="openModal('registerModal')" class="{{ theme.btn }} px-4 py-2 rounded-lg text-white">Cadastro</button>
                    {% endif %}
                    <div class="relative" style="position: static;">
                        <button onclick="toggleThemeMenu()" class="p-2 rounded-full hover:{{ theme.accent }} hover:bg-opacity-20 transition-colors duration-200" title="Alterar Tema">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 {{ theme.text }}">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42" />
                            </svg>
                        </button>
                        <!-- Portal container para o menu -->
                        <div id="menuPortal"></div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <!-- Hero Section -->
        <div class="relative overflow-hidden mb-12 rounded-xl {{ theme.accent }} text-white">
            <div class="absolute inset-0 bg-black opacity-10"></div>
            <div class="relative z-10 p-12">
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="mb-8 md:mb-0 md:w-1/2">
                        <h1 class="text-4xl md:text-5xl font-bold mb-4">Dashboard Generator</h1>
                        <p class="text-xl mb-6 text-gray-100">Transforme seus dados em insights poderosos com visualizações profissionais e interativas</p>
                        {% if not current_user.is_authenticated %}
                        <button onclick="openModal('loginModal')" class="{{ theme.btn }} px-8 py-3 rounded-lg font-semibold transition-colors">
                            Começar Agora
                        </button>
                        {% endif %}
                    </div>
                    <div class="md:w-1/2">
                        <div class="{{ theme.modal }} p-4 rounded-lg shadow-lg">
                            <div id="heroChart" class="chart-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    {% if not current_user.is_authenticated %}
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="{{ theme.modal }} rounded-lg p-8 max-w-md w-full relative">
                <button onclick="closeModal('loginModal')" class="absolute top-4 right-4 {{ theme.accent }} hover:opacity-75 transition-opacity">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <h2 class="text-2xl font-bold mb-6">Login</h2>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block mb-2">Email</label>
                        <input type="email" name="email" required class="{{ theme.input }} w-full px-4 py-2 rounded-lg">
                    </div>
                    <div>
                        <label class="block mb-2">Senha</label>
                        <input type="password" name="password" required class="{{ theme.input }} w-full px-4 py-2 rounded-lg">
                    </div>
                    <div class="text-green-500 hidden mb-4" id="loginSuccess"></div>
                    <div class="text-red-500 hidden" id="loginError"></div>
                    <button type="submit" class="{{ theme.btn }} w-full py-2 rounded-lg text-white">Entrar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="{{ theme.modal }} rounded-lg p-8 max-w-md w-full relative">
                <button onclick="closeModal('registerModal')" class="absolute top-4 right-4 {{ theme.accent }} hover:opacity-75 transition-opacity">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <h2 class="text-2xl font-bold mb-6">Cadastro</h2>
                <form id="registerForm" class="space-y-4">
                    <div>
                        <label class="block mb-2">Nome</label>
                        <input type="text" name="nome" required class="{{ theme.input }} w-full px-4 py-2 rounded-lg">
                    </div>
                    <div>
                        <label class="block mb-2">Email</label>
                        <input type="email" name="email" required class="{{ theme.input }} w-full px-4 py-2 rounded-lg">
                    </div>
                    <div>
                        <label class="block mb-2">Senha</label>
                        <input type="password" name="password" required class="{{ theme.input }} w-full px-4 py-2 rounded-lg">
                    </div>
                    <div class="text-red-500 hidden" id="registerError"></div>
                    <button type="submit" class="{{ theme.btn }} w-full py-2 rounded-lg text-white">Cadastrar</button>
                </form>
            </div>
        </div>
    </div>
    {% endif %}

    <script>
        // Criar menu de temas
        function createThemeMenu() {
            const menuPortal = document.getElementById('menuPortal');
            if (!menuPortal) return;

            // Criar o container do menu
            const menuContainer = document.createElement('div');
            menuContainer.id = 'themeMenuContainer';
            menuContainer.style.position = 'fixed';
            menuContainer.style.top = '0';
            menuContainer.style.left = '0';
            menuContainer.style.width = '100vw';
            menuContainer.style.height = '100vh';
            menuContainer.style.pointerEvents = 'none';
            menuContainer.style.zIndex = '99999';
            document.body.appendChild(menuContainer);

            // Criar o menu
            const menu = document.createElement('div');
            menu.id = 'themeMenu';
            menu.className = 'hidden {{ theme.modal }} rounded-lg shadow-xl py-1 w-56';
            menu.style.position = 'absolute';
            menu.style.pointerEvents = 'auto';
            
            const themes = [
                { 
                    name: 'Escuro', 
                    value: 'dark',
                    preview: 'bg-gradient-to-r from-gray-900 via-gray-800 to-gray-700'
                },
                { 
                    name: 'Claro', 
                    value: 'light',
                    preview: 'bg-gradient-to-r from-blue-500 via-white to-gray-100'
                },
                { 
                    name: 'Neon', 
                    value: 'neon',
                    preview: 'bg-gradient-to-r from-purple-600 via-green-400 to-black'
                },
                { 
                    name: 'Futurista', 
                    value: 'futurist',
                    preview: 'bg-gradient-to-r from-blue-600 via-cyan-400 to-purple-600'
                }
            ];

            themes.forEach(theme => {
                const link = document.createElement('a');
                link.href = '#';
                link.className = 'block px-4 py-2 text-sm hover:{{ theme.accent }} flex items-center justify-between';
                
                // Container para o nome e a prévia
                const contentDiv = document.createElement('div');
                contentDiv.className = 'flex items-center gap-3';
                
                // Nome do tema
                const nameSpan = document.createElement('span');
                nameSpan.textContent = theme.name;
                
                // Bolinha de prévia
                const previewDiv = document.createElement('div');
                previewDiv.className = `w-5 h-5 rounded-full ${theme.preview} border border-gray-400/20`;
                
                contentDiv.appendChild(previewDiv);
                contentDiv.appendChild(nameSpan);
                link.appendChild(contentDiv);
                
                link.onclick = (e) => {
                    e.preventDefault();
                    changeTheme(theme.value);
                    toggleThemeMenu();
                };
                menu.appendChild(link);
            });

            menuContainer.appendChild(menu);
        }

        // Função para controlar o menu de temas
        function toggleThemeMenu() {
            const menu = document.getElementById('themeMenu');
            const button = event.currentTarget;
            const buttonRect = button.getBoundingClientRect();
            
            if (menu.classList.contains('hidden')) {
                menu.style.top = (buttonRect.bottom + 8) + 'px';
                menu.style.left = (buttonRect.right - 192) + 'px'; // 192px é a largura do menu (w-48)
                menu.classList.remove('hidden');
            } else {
                menu.classList.add('hidden');
            }
        }

        // Fechar o menu quando clicar fora
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('themeMenu');
            const button = event.target.closest('button');
            
            if (!menu || menu.classList.contains('hidden')) return;
            
            if (!button && !menu.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });

        // Criar o menu quando a página carregar
        document.addEventListener('DOMContentLoaded', createThemeMenu);

        // Função para obter cor do tema
        function getThemeColor(element, property) {
            return window.getComputedStyle(element).getPropertyValue(property);
        }

        // Função para ajustar cores (clarear/escurecer)
        function adjustColor(color, factor) {
            // Converte cor para RGB se for HEX
            let r, g, b;
            if (color.startsWith('#')) {
                r = parseInt(color.slice(1, 3), 16);
                g = parseInt(color.slice(3, 5), 16);
                b = parseInt(color.slice(5, 7), 16);
            } else if (color.startsWith('rgb')) {
                const matches = color.match(/\d+/g);
                r = parseInt(matches[0]);
                g = parseInt(matches[1]);
                b = parseInt(matches[2]);
            }
            
            // Ajusta os valores
            r = Math.round(r * factor);
            g = Math.round(g * factor);
            b = Math.round(b * factor);
            
            // Garante que os valores estão entre 0 e 255
            r = Math.min(255, Math.max(0, r));
            g = Math.min(255, Math.max(0, g));
            b = Math.min(255, Math.max(0, b));
            
            return `rgb(${r}, ${g}, ${b})`;
        }
        
        // Inicialização dos gráficos
        document.addEventListener('DOMContentLoaded', function() {
            // Obtém as cores do tema atual
            const themeElement = document.querySelector('[data-theme]');
            const accentColor = getThemeColor(document.querySelector('.{{ theme.accent }}'), 'color');
            const textColor = getThemeColor(document.querySelector('.{{ theme.text }}'), 'color');
            // Hero Chart
            const heroChartOptions = {
                series: [{
                    name: 'Crescimento',
                    data: [30, 40, 35, 50, 49, 60, 70, 91, 125]
                }],
                chart: {
                    type: 'area',
                    height: 350,
                    toolbar: {
                        show: false
                    },
                    animations: {
                        enabled: true,
                        easing: 'easeinout',
                        speed: 800,
                        animateGradually: {
                            enabled: true,
                            delay: 150
                        },
                        dynamicAnimation: {
                            enabled: true,
                            speed: 350
                        }
                    },
                    foreColor: textColor
                },
                colors: [accentColor],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.9,
                        stops: [0, 90, 100],
                        colorStops: [
                            {
                                offset: 0,
                                color: accentColor,
                                opacity: 0.7
                            },
                            {
                                offset: 100,
                                color: accentColor,
                                opacity: 0.1
                            }
                        ]
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                xaxis: {
                    categories: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set'],
                    labels: {
                        style: {
                            colors: '#fff'
                        }
                    }
                },
                yaxis: {
                    labels: {
                        style: {
                            colors: '#fff'
                        }
                    }
                },
                tooltip: {
                    theme: 'dark'
                }
            };
            const heroChart = new ApexCharts(document.querySelector("#heroChart"), heroChartOptions);
            heroChart.render();

            // Growth Chart
            const growthChartOptions = {
                series: [{
                    name: 'Crescimento',
                    data: [10, 15, 12, 20, 18, 25, 22]
                }],
                chart: {
                    type: 'line',
                    height: 200,
                    toolbar: {
                        show: false
                    },
                    sparkline: {
                        enabled: true
                    }
                },
                colors: [accentColor],
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                tooltip: {
                    theme: theme === 'dark' ? 'dark' : 'light',
                    fixed: {
                        enabled: false
                    },
                    x: {
                        show: false
                    },
                    marker: {
                        show: false
                    }
                },
                chart: {
                    foreColor: textColor
                }
            };
            const growthChart = new ApexCharts(document.querySelector("#growthChart"), growthChartOptions);
            growthChart.render();

            // Performance Chart
            const performanceChartOptions = {
                series: [89.7],
                chart: {
                    type: 'radialBar',
                    height: 200,
                    sparkline: {
                        enabled: true
                    },
                    foreColor: textColor
                },
                colors: [accentColor],
                plotOptions: {
                    radialBar: {
                        startAngle: -90,
                        endAngle: 90,
                        track: {
                            background: textColor,
                            opacity: 0.2,
                            strokeWidth: '97%',
                            margin: 5
                        },
                        hollow: {
                            size: '60%'
                        },
                        dataLabels: {
                            name: {
                                show: false
                            },
                            value: {
                                offsetY: -2,
                                fontSize: '22px',
                                color: textColor
                            }
                        }
                    }
                }
            };
            const performanceChart = new ApexCharts(document.querySelector("#performanceChart"), performanceChartOptions);
            performanceChart.render();

            // Distribution Chart
            const distributionChartOptions = {
                series: [44, 55, 67, 83],
                chart: {
                    type: 'donut',
                    height: 200,
                    sparkline: {
                        enabled: true
                    },
                    foreColor: textColor
                },
                colors: [
                    accentColor,
                    adjustColor(accentColor, 0.8),
                    adjustColor(accentColor, 0.6),
                    adjustColor(accentColor, 0.4)
                ],
                labels: ['Categoria A', 'Categoria B', 'Categoria C', 'Categoria D'],
                plotOptions: {
                    pie: {
                        donut: {
                            size: '65%'
                        }
                    }
                }
            };
            const distributionChart = new ApexCharts(document.querySelector("#distributionChart"), distributionChartOptions);
            distributionChart.render();

            // Configurações padrão para todos os gráficos
            const defaultChartOptions = {
                chart: {
                    foreColor: textColor
                },
                colors: [accentColor],
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        columnWidth: '70%',
                    }
                },
                dataLabels: {
                    enabled: false
                },
                xaxis: {
                    categories: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul'],
                }
            };
            const revenueChart = new ApexCharts(document.querySelector("#revenueChart"), revenueChartOptions);
            revenueChart.render();
        });

        function changeTheme(theme) {
            fetch(`/theme/${theme}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            }).then(response => response.json())
              .then(data => {
                  if (data.message) {
                      window.location.reload();
                  }
              });
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function logout() {
            fetch('/logout')
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        window.location.href = '/';
                    }
                });
        }

        document.getElementById('loginForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(Object.fromEntries(formData))
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('loginError').textContent = data.error;
                    document.getElementById('loginError').classList.remove('hidden');
                } else {
                    window.location.href = '/dashboard';
                }
            });
        });

        document.getElementById('registerForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(Object.fromEntries(formData))
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('registerError').textContent = data.error;
                    document.getElementById('registerError').classList.remove('hidden');
                } else {
                    // Limpa o formulário de cadastro e esconde erros
                    document.getElementById('registerForm').reset();
                    document.getElementById('registerError').classList.add('hidden');

                    // Fecha o modal de cadastro
                    closeModal('registerModal');
                    
                    // Abre o modal de login
                    openModal('loginModal');
                    
                    // Exibe a mensagem de sucesso no modal de login
                    const loginSuccess = document.getElementById('loginSuccess');
                    loginSuccess.textContent = data.message;
                    loginSuccess.classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>
